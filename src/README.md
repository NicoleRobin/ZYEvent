# zyevent 开发进度

## 计划
> 从最简单的使用opoll的一个类似echo的网络服务器开始，逐步扩展，形成一个完整的类似于libevent的网络库，把每个阶段的开发进度记录在这里。

## 版本
V_0.1
> 利用epoll实现一个简单的网络服务器，服务器的功能是：接收连接，接收消息，对一个每一个收到的消息，回复一个"Recv data!"的消息。  
> 下一个版本计划通过添加一个map来保存客户端发送过来的消息，在套接字可写时，把消息发送出去，实现一个真正的echo服务器。

V_0.2
> 通过一个map来保存客户端发送过来的消息，实现了一个真正的echo服务器。  

V_0.3
> 该版本实现了回调，与上一个版本中使用epoll_event.data.fd保存套接字描述符不同，这次利用epoll_event.data.ptr来保存一个定义的结构体struct event，该结构中包含套接字描述符，关心的事件，缓冲区，缓冲区中数据长度，已发送的偏移量，回调函数。  
> 添加了设置套接字为非阻塞的函数setnonblock。  
> 下个版本需要解决的问题：1.客户端关闭时，服务器无法知道，所以需要有一个机制来判断现在客户端是不是已经关闭了。  

v_0.4
> 对于上一个版本说到问题，我首先想到的办法就是在结构体中定义个变量来保存上次收到消息的时间戳，然后在每次处理完事件后，判断是否有超时的套接字，将其从epfd中删除并关闭即可。  
> 这里是我想错了，如果客户端正常关闭的话，服务器是可以感知到的，需要用超时来处理的是那些客户端直接崩溃导致没有给服务器发送关闭请求的情况。  
> 我做了个小实验，使用kill -9把已连接的客户端杀死，服务器还是可以立即感知到，不知道是什么原因造成，这里超时处理先不考虑，等搞明白这个问题再说。  
